{% extends "layout_2_col.html" %}

{% load url from future %}

{% load currency_filters %}
{% load thumbnail %}
{% load product_tags %}
{% load i18n %}


{% block extrahead %}

{{block.super}}

    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }

    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key={{mapsKey}}&sensor=false">
    </script>
    <script type="text/javascript">
      

     var markers = [];
     infoWindows = Array();


      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(34., -118.244),
          zoom: 8
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);


        {% for res in spatial_results %}
              {% if res.object.get_location  %}
                  

           var myInfoWindow = new google.maps.InfoWindow({
              content: "{{res.object.title}}",
              minwidth:200,
              maxwidth:20,

          });

          var marker = new google.maps.Marker({
              position: new google.maps.LatLng({{res.object.getLatLong.0}}, {{res.object.getLatLong.1}}),
              map: map,
              title: "{{res.object.title}}",
              infowindow: myInfoWindow,

          });

       

          google.maps.event.addListener(marker, 'click', function() {
        for(var i=0; i < markers.length; i++){
            markers[i].infowindow.close();
        }

            this.infowindow.open(map, this);
          });

          markers.push(marker);
       
            {% endif %}

            {% endfor %}

       



      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>

{% endblock %}


{% block title %}
    "{{ query }}" | {{ block.super }}
{% endblock %}

{% block breadcrumbs %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url 'promotions:home' %}">{% trans "Home" %}</a>
            <span class="divider">/</span>
        </li>
        <li>
            {% trans "Search" %}
            <span class="divider">/</span>
        </li>
        <li class="active">"{{ query }}"</li>
    </ul>
{% endblock %}


{% block column_left %}
{% comment %}
    {#{{spatial_results}}#}

    {# TODO - generate this block automatically using the facets setting #}
    <h4>{% trans "Refine your search" %}</h4>
    <dl>
        {% if facet_data.category %}
            {% include 'search/partials/facet.html' with name='Category' items=facet_data.category %}
        {% endif %}

        {% if facet_data.price_range %}
            {% include 'search/partials/facet.html' with name='Price range' items=facet_data.price_range %}
        {% endif %}
    </dl>
{% endcomment %}
{% endblock %}

{% block headertext %}
    {% blocktrans with q=query %}
        <div style="font-size:0.8em">Products matching "{{ q }}" </div>
    {% endblocktrans %}
{% endblock %}

{% block content %}




        <section>
            <div class="mod">
                {% include "search/partials/pagination.html" %}
                <ol class="products three">
    {% for res in spatial_results %}

            {% if not "disabled" in res.object.status or request.user.is_admin or request.user == partner.user %}
                <li>{% render_product res.object %}</li>
            {% endif %}

    {% endfor %}

                </ol>

            </div>
        </section>
   

    {% if suggestion %}
        {% trans 'Did you mean' %} <a href="{% url 'search:search' %}?q={{ suggestion }}">{{ suggestion }}</a>?
    {% endif %}

    {% if page.object_list %}
        {% comment %}
        <section>
            <div class="mod">
                {% include "search/partials/pagination.html" %}
                <ol class="products four">
                    {% for result in page.object_list %}
                        {{result.object.status}}444
                        {#{% if not "disable" in result.object.status or request.user.is_staff %}#}
                        {% if False %}
                        <li>{% render_product result.object %}</li>
                        {% endif %}
                        }
                    {% endfor %}
                </ol>
                {% include "search/partials/pagination.html" %}
            </div>
        </section>
        {% endcomment %}
{% comment %}
          <section>
            <div class="mod">
                <ol class="products three">
                    {% for result in page.object_list %}
                      {% if not "disable" in result.object.status or request.user.is_staff %}
                        <li>{% render_product result.object %}</li>
                      {% endif %}
                    {% endfor %}
                </ol>
                {% include "partials/pagination.html" %}
            </div>
        </section>
{% endcomment %}

    {% else %}
        <p>{% trans 'No search results found.' %}</p>
    {% endif %}


          <div id="map-canvas" style="width:100%;height:300px;"> </div>

 {% for res in spatial_results %}
              {% if res.object.get_location  %}
              {{res.object.title}}  {{res.object.getLatLong}}
              <br>
              {% endif %}

              {% endfor %}
        

{% endblock %}
