{% extends "layout.html" %}
{% load url from future %}
{% load currency_filters %}
{% load i18n %}

{% block body_class %}account-pages{% endblock %}

{% block breadcrumbs %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url 'promotions:home' %}">{% trans 'Home' %}</a>
            <span class="divider">/</span>
        </li>
        <li>
            <a href="{% url 'customer:summary' %}">{% trans 'Account' %}</a>
            <span class="divider">/</span>
        </li>
        <li class="active">{% trans 'Sales history' %}</li>
    </ul>
{% endblock %}

{% block title %}
    {% trans '{{order_or_sales_title}} history' %} | {{ block.super }}
{% endblock %}

{% block subnavigation %}
    {% include "partials/nav_profile.html" with sales_history="active" %}
{% endblock %}

{% block subheader %}
    <div class="sub-header">
        <h2>{{order_or_sales_title}} history</h2>
    </div>
{% endblock subheader %}

{% block content %}

    <h3>{% trans 'Search in received orders' %}</h3>
    <form action="." method="get">
        {% include "partials/form_fields.html" with form=form %}
        <button type="submit" class="btn btn-primary">{% trans 'Filter results' %}</button>
        <a href="{% url 'customer:order-list' %}" class="btn">{% trans 'Reset' %}</a>
    </form>

    <h3>{{ form.description }}</h3>
    {% if orders %}
        <table class="table table-striped table-bordered">
            <tr>
                <th>{% trans 'Order number' %}</th>
                <th>{% trans 'Total inc tax' %}</th>
                <th>{% trans 'Date submitted' %}</th>
                <th></th>
            </tr>
            {% for order in orders %}
                <tr>
                    <td>{{ order.number }}</td>
                    <td>{{ order.total_incl_tax|currency }}</td>
                    <td>{{ order.date_placed }}</td>
                    <td>
                        <a class="btn btn-info" href="{% url 'customer:order' order.number %}?user_id={{order.user.id}}">{% trans 'View Order Detail' %}</a>
                       
                        <div style="clear:both"></div>
                       {% if order.shipping_incl_tax > 0.0 %}
                    
                    
                         <form id="order_form_{{ order.id }}" action="{% url 'customer:order' order.number %}?user_id={{order.user.id}}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="order_id" value="{{ order.id }}" />
                            <input type="hidden" name="action" value="show_label" />
                            <button type="submit" class="btn btn-info">{% trans 'Show label' %}</button>
                         </form>

                          {% for source in order.sources.all %}
                            
                                {% if source.source_type.name = "Stripe" %}
                                    <a class="btn btn-info" href="https://manage.stripe.com/payments/{{source.reference}}">{% trans 'View payment on Stripe' %}</a>
                                   {% endif%}
                        {% endfor %}

                         {% comment %}
                        <form id="order_form_{{ order.id }}" action="{% url 'customer:order' order.number %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="order_id" value="{{ order.id }}" />
                            <input type="hidden" name="action" value="showLabel" />
                            <button type="submit" class="btn btn-success">{% trans 'Get shipping label' %}</button>
                        </form>
                        {% endcomment %}

                       {% endif %}

                    </td>
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>{% trans 'No received orders found' %}</p>
    {% endif %}

    {% include "partials/pagination.html" %}

{% endblock content %}

